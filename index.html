<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>API Calling Using FetchAPI</title>
</head>
<body>
    <h1>API Calling Using FetchAPI</h1>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul class="list-group">
              <li class="list-group-item">An item</li>
              <li class="list-group-item">A second item</li>
              <li class="list-group-item">A third item</li>
              <li class="list-group-item">A fourth item</li>
              <!-- <li class="list-group-item">And a fifth one</li> -->
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <button class="mybtn btn btn-success btn sm">Get TODOS</button>
    <div class="d-flex justify-content-center d_myspinner">
        <div class="spinner-border text-success" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    <table class="table">
        <thead>
          <tr>
            <th scope="col">UserID</th>
            <th scope="col">Id</th>
            <th scope="col">Title</th>
            <th scope="col">Status</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          
        </tbody>
      </table>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
document.querySelector('button.mybtn').addEventListener('click',function(){
    //alert('ok');
    /*
    fetch('http://example.com/movies.json')
    .then(response => response.json())
    .then(data => console.log(data));
    */
    
    //then(success)
    //catch(Error)

    fetch('https://jsonplaceholder.typicode.com/todos', {method:'GET'})
    .then((response) => {
        response.json().then((data) =>{
          //remove d_myspinner
          document.querySelector('.d_myspinner').remove();
            console.log(data);
            var tr = '';
            data.forEach((currentValue,index,arr) => {
                console.log(currentValue);
                tr = tr +  `<tr>
                              <td>`+currentValue.userId+`</td>
                              <td>`+currentValue.id+`</td>
                              <td>`+currentValue.title+`</td>
                              <td>`+currentValue.completed+`</td>
                              <td>
                                <button class="btn btn-sm btn-success d_viewbtn" data-bs-toggle="modal" data-bs-target="#exampleModal">View</button>
                                
                                <button class="btn btn-sm btn-primary">Edit</button>
                                <button class="btn btn-sm btn-danger d_delbtn">Delete</button>
                              </td>
                            </tr>`;
                            //data-bs-toggle="modal" data-bs-target="#exampleModal"
            });//foreach end here
            console.log(tr);

            document.querySelector('table >tbody').innerHTML = tr;
        })
        // this is a success block
    })
    .catch(function(error){
        //This is Error block

    });//Function changing
});
  // i want to add eevent listerner on whole page
    document.addEventListener('click',function(e){//e=event
      if(e.target && e.target.classList[3] == 'd_viewbtn'){
        let title = e.target.closest('tr').querySelector('td:nth-child(3)').innerHTML
      let status = e.target.closest('tr').querySelector('td:nth-child(4)').innerHTML
      let userid = e.target.closest('tr').querySelector('td:first-child').innerHTML
      let id = e.target.closest('tr').querySelector('td:nth-child(2)').innerHTML
      console.log(status);
      console.log(userid);
      console.log(id);



      document.querySelector('.modal-body > .list-group >li:first-child').innerHTML= userid;
      document.querySelector('.modal-body > .list-group >li:nth-child(2)').innerHTML= id;
      document.querySelector('.modal-body > .list-group >li:nth-child(3)').innerHTML= title;
      document.querySelector('.modal-body > .list-group >li:last-child').innerHTML= status;
      }
      if(e.target && e.target.classList[3] == 'd_delbtn'){
        alert('okkkkkkkk');
        e.target.closest('tr').remove();
      }
      // alert('ok')
      //console.log(e.target.closest('tr').querySelector('td:nth-child(3)').innerHTML);
      
      /*
      if(e.target && e.target.id== 'brnPrepend'){
        //do something
      }*/
    })
    </script>
</body>
</html>